@page
@model RazorPages_PRN222.Pages.Admin.IndexModel
@{
    ViewData["Title"] = "Admin Dashboard";
    Layout = "~/Pages/Shared/_AdminLayout.cshtml";
}


<div class="container">
    <h1>Admin Dashboard</h1>
    <div class="row">
        <div class="col-md-3">
            <h4>Total Users</h4>
            <div class="display-6">@Model.TotalUsers</div>
        </div>
        <div class="col-md-3">
            <h4>Total Courses</h4>
            <div class="display-6">@Model.TotalCourses</div>
        </div>
        <div class="col-md-3">
            <h4>Total Announcements</h4>
            <div class="display-6">@Model.TotalAnnouncements</div>
        </div>
        <div class="col-md-3">
            <h4>Total Orders</h4>
            <div class="display-6">@Model.TotalOrders</div>
        </div>
    </div>
    <hr />
    <div class="row">
        <div class="col-md-3">
            <h5>Total Revenue</h5>
            <div class="h3">@Model.TotalRevenue.ToString("C")</div>
        </div>
        <div class="col-md-3">
            <h5>Payments Today</h5>
            <div class="h3">@Model.PaymentsToday</div>
        </div>
        <div class="col-md-3">
            <h5>Enrollments Today</h5>
            <div class="h3">@Model.EnrollmentsToday</div>
        </div>
        <div class="col-md-3">
            <h5>Average Rating</h5>
            <div class="h3">@Model.AverageRating.ToString("0.0")</div>
        </div>
    </div>
    <hr />
    <div class="row">
        <div class="col-md-3">
            <h5>New Users (7 days)</h5>
            <div class="h3">@Model.NewUsersLast7Days</div>
        </div>
    </div>

    <hr />
    <div class="row">
        <div class="col-md-6">
            <h5>Revenue (Last 7 days)</h5>
            <canvas id="revenueChart" height="140"></canvas>
        </div>
        <div class="col-md-6">
            <h5>Payments (Last 7 days)</h5>
            <canvas id="paymentsChart" height="140"></canvas>
        </div>
    </div>
    <div class="row mt-4">
        <div class="col-md-6">
            <h5>Enrollments (Last 7 days)</h5>
            <canvas id="enrollmentsChart" height="140"></canvas>
        </div>
        <div class="col-md-6">
            <h5>New Users (Last 7 days)</h5>
            <canvas id="newUsersChart" height="140"></canvas>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    const labels = @Html.Raw(Model.LabelsJson);
    const revenueSeries = @Html.Raw(Model.RevenueSeriesJson);
    const paymentsSeries = @Html.Raw(Model.PaymentsSeriesJson);
    const enrollmentsSeries = @Html.Raw(Model.EnrollmentsSeriesJson);
    const newUsersSeries = @Html.Raw(Model.NewUsersSeriesJson);

    function makeLineChart(canvasId, label, data, color) {
        const ctx = document.getElementById(canvasId).getContext('2d');
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [{
                    label: label,
                    data: data,
                    borderColor: color,
                    backgroundColor: color + '33',
                    fill: true,
                    tension: 0.3,
                    pointRadius: 3
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: { display: false }
                },
                scales: {
                    x: { grid: { display: false } },
                    y: { beginAtZero: true }
                }
            }
        });
    }

    makeLineChart('revenueChart', 'Revenue', revenueSeries, '#0d6efd');
    makeLineChart('paymentsChart', 'Payments', paymentsSeries, '#198754');
    makeLineChart('enrollmentsChart', 'Enrollments', enrollmentsSeries, '#6f42c1');
    makeLineChart('newUsersChart', 'New Users', newUsersSeries, '#fd7e14');
</script>
</div>